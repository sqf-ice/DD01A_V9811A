C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE API_LCD_DISPLAY
OBJECT MODULE PLACED IN .\Api_Lcd_Display.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\C_Source\S4_ApiUser\Api_Lcd_Display.c LARGE BROWSE INCDIR(..\C_Source\S0
                    -_System;..\C_Source\S1_HardDrv;..\C_Source\S2_MyLib;..\C_Source\S3_ApiPlat;..\C_Source\S4_ApiUser;..\C_Source\S5_ApiProt
                    -ocol;..\C_Source\S6_MyIncludes;..\C_Source\S1_HardDrv\V9811A_EMU;..\C_Source\S1_HardDrv\V9811A_MCU;..\C_Source\S1_HardDr
                    -v\E2P_24CXXX) DEBUG OBJECTEXTEND PRINT(.\Api_Lcd_Display.lst) OBJECT(.\Api_Lcd_Display.obj)

line level    source

   1          /*
   2          *****************Copyright (c)*************************************
   3          **      Hangzhou Xili Watthour Meter Manufacture Co., Ltd. 
   4          **--------------file info--------------------------------------------
   5          **name                  : Api_Lcd_Display.c
   6          **Author                : maji
   7          **date                  : 2016-04-21 
   8          **description   : Òº¾§ÏÔÊ¾Ó¦ÓÃ²ãÏà¹Øº¯Êý³ÌÐòCÎÄ¼þ
   9          **note                  : V9811A £¬MERTER FOR DL03C
  10          **--------------------Version History -------------------------------------
  11          ** NO. Date         Ver      By         Description 
  12          **==============================================================
  13          ** 1   2016-04-26   v01.00   sosomj     1. frist version                             
  14          **
  15          **==============================================================
  16          */
  17          
  18          
  19          #include <MyIncludes_H.h>
  20          
  21          
  22          /*******************************************************************************
  23          * È«¾Ö±äÁ¿¶¨ÒåÇø
  24          *******************************************************************************/
  25          DIS_PARAM_DATA   gs_dis_param;   // µçÁ¿ÏÔÊ¾Ïà¹Ø²ÎÊý  //
  26          DIS_CTL_VAR  gs_dis_ctl_var;
  27          DIS_PIXEL_VAR  gs_dis_pixel_var;
  28          LCDDISTAB   gs_LCDDISTAB_var;
  29          INT8U dis_data_type = 0;//µç±íÉÏÅÅÏÔÊ¾µçÁ¿»¹ÊÇÊ±¼ä»¹ÊÇÈÕÆÚµÄ±êÖ¾
  30          INT8U dis_data_sec = 0;//³ý¹¦ÂÊÍâÏÔÊ¾³ÖÐøÊ±¼ä
  31          INT8U dis_num_char = 0; //0:µ±Ç°µçÁ¿£¬          1:µ±Ç°ÐèÁ¿£¬            2:µ±Ç°ÀÛ¼Æ×î´óÐèÁ¿£¬
  32                                                          //3:Ç°Ò»ÌìµçÁ¿£¬4:Ç°Ò»ÌìÐèÁ¿£¬5:Ç°Ò»ÌìÀÛ¼Æ×î´óÐèÁ¿
  33          
  34          
  35          
  36          
  37          /*******************************************************************************
  38          * ³£Á¿±íÇø
  39          *******************************************************************************/
  40          const DIS_PARAM_DATA   code default_dis_param_tab= {
  41              5,  //uint8  auto_sec;    // ×Ô¶¯Ñ­»·ÏÔÊ¾³ÖÐøÊ±¼ä  //
  42              15, //uint8  key_sec;     // °´¼üÏÔÊ¾³ÖÐøÊ±¼ä  //
  43              360,//uint8  bg_sec;     // ÏÂµçÏÔÊ¾Î¬³ÖÊ±¼ä Ä¬ÈÏ6Ð¡Ê± µ¥Î»min//
  44              0x51,//uint8  ec_form;     // µçÁ¿¸ñÊ½  //
  45              4,//uint8  auto_item[21];    //0ÎªÏÔÊ¾¸öÊý£¬1~19ÎªÏÔÊ¾ÏîÄ¿£¬×î´ó¿ÉÒÔÏÔÊ¾31¸öÏîÄ¿  //
  46              1,2,3,4,0xFF,0xFF,            //uint8  auto_item[1~10];     //µçÑ¹ÆÁ£¬µçÁ÷ÆÁ£¬¹¦ÂÊÆÁ£¬ÆµÂÊÆÁ
  47              0x00,//INT16U  u16_csck;    //16Î»ÀÛ¼ÓºÍÐ£ÑéÖµ//
  48          };
  49          
  50          
  51          //  ³£Á¿×Ö·û±í¶¨Òå x  // D C B A - E G F 
  52          const INT8U code  NumSegD1_D6[DS_Chr_All_NUM] = 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 2   

  53          {       DS_Chr_0,DS_Chr_1,DS_Chr_2,
  54                  DS_Chr_3,DS_Chr_4,DS_Chr_5,
  55                  DS_Chr_6,DS_Chr_7,DS_Chr_8,
  56                  DS_Chr_9,
  57                  DS_Chr_A,DS_Chr_b,DS_Chr_C,
  58                  DS_Chr_d,DS_Chr_E,DS_Chr_F
  59          };
  60          
  61          const INT8U code  NumSegD7_D9[DS_Chr_All_NUM] = 
  62          {       DS_OBIS_Chr_0,DS_OBIS_Chr_1,DS_OBIS_Chr_2,
  63                  DS_OBIS_Chr_3,DS_OBIS_Chr_4,DS_OBIS_Chr_5,
  64                  DS_OBIS_Chr_6,DS_OBIS_Chr_7,DS_OBIS_Chr_8,
  65                  DS_OBIS_Chr_9,
  66                  DS_OBIS_Chr_A,DS_OBIS_Chr_b,DS_OBIS_Chr_C,
  67                  DS_OBIS_Chr_d,DS_OBIS_Chr_E,DS_OBIS_Chr_F
  68          };
  69          
  70          
  71          
  72          
  73          //-------------------------------------------------------------------------------//
  74          //  Function:     Òº¾§ÏÔÊ¾ÏîÄ¿µÄÔªËØ±í       --ÔÚROMÇø
  75          //-------------------------------------------------------------------------------//
  76          
  77          const LCDDISTAB code LcdDisTab[] =
  78           {  
  79                  //DisID ,ObisNum ,      Addr ,  DisInfo,        chartype,       obis_digit              
  80                  ////////////////////////////ALL  DISPLAY////////////////////////////////////////////////////////
  81                  0,  0x8888,     0X0000,                                                                         0 ,                                     0,      OBIS_DIGIT_TYPE0,       // ALL DISPLAY  //
  82                  1,  0x327F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_u_val.B08[2],(MEM_RAM<<8)+2, CHAR_V,OBIS_
             -DIGIT_TYPE1,        //µçÑ¹
  83                  2,      0x317F, (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_i_val.B08[0],(MEM_RAM<<8)+2, CHAR_A,OBIS_D
             -IGIT_TYPE2,        //µçÁ÷
  84                  3,  0x170F,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_p_val.B08[0],(MEM_RAM<<8)+2,        CHAR_KW,OBIS
             -_DIGIT_TYPE2,        //ÓÐ¹¦¹¦ÂÊ      
  85                  4,  0x1470,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].w_freq_val[0],(MEM_RAM<<8)+2,  CHAR_HZ,OBIS_D
             -IGIT_TYPE2,        //ÆµÂÊ  
  86                  5,  0x1370,     (INT16U)&gs_measure_var_data.gs_really[PHASE_TT].dw_pf_val[0],(MEM_RAM<<8)+2,   CHAR_PF,OBIS_DI
             -GIT_TYPE3,        // ¹¦ÂÊÒòÊý     
  87          
  88                  ////////////////////////////ACTIVE ENERGY  DISPLAY///////////////////////////////////////////////////////
             -/
  89                  // 0x01,  0x180F,        (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0],               (MEM_RAM<
             -<8)+6,        CHAR_AEC,OBIS_DIGIT_TYPE1,      // L0 ACTIVE ENERGY TOTAL 
  90          } ;
  91                                                   
  92          
  93          /*****************************************************************************
  94          ** Function name    :api_init_md_data_ram
  95          **
  96          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
  97          **
  98          ** Parameters         :NONE          
  99          **
 100          ** Returned value   :NONE
 101          **
 102          **----------------------------------------------------------------------------
 103          ** V01.01  MJ  2016-04-23
 104          ******************************************************************************/
 105          void api_init_display(void)
 106          {
 107   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 3   

             -    
 108   1          gs_dis_ctl_var.mode = DIS_MODE_RESET;
 109   1          gs_dis_ctl_var.item = DIS_RESET;
 110   1          gs_dis_ctl_var.ptr[0] =1;  //´í¹ýÌõÊýÊý×é //
 111   1          gs_dis_ctl_var.keep_sec[0] = 0;
 112   1          gs_dis_ctl_var.keep_sec[1] = 0;
 113   1          gs_dis_ctl_var.keep_sec[2] = 0;             //  ±³¹âÉÏµçµãÁÁ15S//
 114   1          gs_dis_ctl_var.keep_sec[3] = RESEAT_DIS_KEEP_3S; //  ÉÏµçÈ«ÆÁÏÔÊ¾Ê±¼ä
 115   1      }
 116          
 117          
 118          /*****************************************************************************
 119          ** Function name    :api_init_md_data_ram
 120          **
 121          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 122          **
 123          ** Parameters         :NONE          
 124          **
 125          ** Returned value   :NONE
 126          **
 127          **----------------------------------------------------------------------------
 128          ** V01.01  MJ  2016-04-23
 129          ******************************************************************************/
 130          void api_handl_dis_key(void)
 131          {
 132   1      
 133   1          if((gs_dis_ctl_var.mode == DIS_MODE_NOMAL)||(gs_dis_ctl_var.mode == DIS_MODE_RESET))
 134   1          {
 135   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 136   2              mem_read(&gs_dis_param.auto_item[0], ADR_DIS_PARAM_AUTO_TAB, 32, MEM_E2P1);      // 
 137   2              //gs_dis_ctl_var.ptr[0] =0xff;
 138   2          }
 139   1      
 140   1          gs_dis_ctl_var.keep_sec[1] = gs_dis_param.key_sec; // °´¼ü³ÖÐøÊ±¼ä
 141   1          gs_dis_ctl_var.item = api_get_next_dis_item();
 142   1      
 143   1      }
 144          
 145          /*****************************************************************************
 146          ** Function name    :api_init_md_data_ram
 147          **
 148          ** Description         :³õÊ¼»¯µ±Ç°ÐèÁ¿¼ÆËãRAMÇøÊý¾Ý£¬³ÌÐò¸´Î»³õÊ¼»¯µ÷ÓÃ        
 149          **
 150          ** Parameters         :NONE          
 151          **
 152          ** Returned value   :NONE
 153          **
 154          **----------------------------------------------------------------------------
 155          ** V01.01  MJ  2016-04-23
 156          ******************************************************************************/
 157          void api_handl_dis_sleep(void)
 158          {
 159   1          gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    
 160   1          gs_dis_ctl_var.mode = DIS_MODE_NOMAL ;
 161   1          mem_read(&gs_dis_param.auto_sec, ADR_BLOCK21_DIS_PARAM_E2P, LEN_BLOCK21_DIS_PARAM_E2P, MEM_E2P1);    // 
             -  
 162   1          api_updated_LCDDisplayPixel_per_second();
 163   1      }
 164          
 165          
 166          
 167          /*****************************************************************************
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 4   

 168          ** Function name    :api_updata_LCDDisplay_per_second
 169          **
 170          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 171          **
 172          ** Parameters         :NONE          
 173          **
 174          ** Returned value   :NONE
 175          **
 176          **----------------------------------------------------------------------------
 177          ** V01.01  MJ  2016-04-23
 178          ******************************************************************************/
 179          void api_updated_LCDDisplayPixel_per_second(void)
 180          {               
 181   1          Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0,DS_UNIT);
 182   1              Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
 183   1              Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0] ,0,DS_DATANum);
 184   1              Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
 185   1              
 186   1          // Ôö¼ÓÓ²¼þÐ£±íÏÔÊ¾¹¦ÄÜ //
 187   1          if((gs_dis_ctl_var.item>=DIS_ADJ_CH1_0) &&(gs_dis_ctl_var.item<=DIS_DATA_CLR))
 188   1          {
 189   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 190   2              //      Link_Get_Dis_Data_Num_buff();
 191   2              //      Link_Get_Dis_Char_buff();            
 192   2          //    if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 193   2              Link_Get_Dis_Drv_buff();                
 194   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 195   2              return;
 196   2          }
 197   1          if(gs_dis_ctl_var.item==DIS_DATA_BROADCAST) 
 198   1          {
 199   2              api_LCDDisplay_adj_item(gs_dis_ctl_var.item);
 200   2                      Link_Get_Dis_Data_Num_buff();
 201   2                      Link_Get_Dis_Char_buff();            
 202   2              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)Link_Get_Dis_RealChar_buff();
 203   2              Link_Get_Dis_Drv_buff();                
 204   2              Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯//
 205   2              return;
 206   2          }
 207   1          if(gs_dis_ctl_var.item>DIS_MAX_ITEM)
 208   1          {
 209   2              gs_dis_ctl_var.item = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 210   2          }
 211   1      
 212   1          if(gs_dis_ctl_var.item == DIS_RESET)
 213   1          {
 214   2              Lib_Set_String(&gs_dis_pixel_var.dis_buff[0],0xff,DS_UNIT);
 215   2          }
 216   1          else
 217   1          {
 218   2                      Link_Get_DisTab_Var(gs_dis_ctl_var.item) ;              // »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢  //
 219   2                      Link_Get_Dis_Data_Num_buff();
 220   2              //      Link_Get_Dis_OBIS_Num_buff();                   //ÏÂÅÅÓÃÀ´ÏÔÊ¾ÆäËûÊý¾Ý //
 221   2                      Link_Get_Dis_Char_buff();            
 222   2                      if(gs_sys_globaL_var.work_mode != SLEEP_MODE)  Link_Get_Dis_RealChar_buff();
 223   2                      Link_Get_Dis_Drv_buff();                 
 224   2          }
 225   1      
 226   1          Write_LCD(&gs_dis_pixel_var.dis_buff[0]);         //½«Êý¾ÝÐ´ÈëÒº¾§Çý¶¯
 227   1      }
 228          
 229          
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 5   

 230          /*****************************************************************************
 231          ** Function name    :api_updata_LCDDisplay_per_second
 232          **
 233          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÄÚÈÝ      
 234          **
 235          ** Parameters         :NONE          
 236          **
 237          ** Returned value   :NONE
 238          **
 239          **----------------------------------------------------------------------------
 240          ** V01.01  MJ  2016-04-23
 241          ******************************************************************************/
 242          void api_updated_LED_per_second(void)
 243          {
 244   1         // ·´ÏòÖ¸Ê¾  ÈÎÒâÒ»Ïà·´ÏòÔòµÆÁÁ//      
 245   1         if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)// ÓÐ¹¦ºÏÏà¹¦ÂÊ·´Ïò
 246   1         {
 247   2              //LED_L2_REV_ON();
 248   2         }
 249   1         else 
 250   1         {
 251   2              //LED_L2_REV_OFF();
 252   2         }
 253   1      }
 254          
 255          
 256          /*****************************************************************************
 257          ** Function name    :api_init_md_data_ram
 258          **
 259          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
 260          **
 261          ** Parameters         :NONE          
 262          **
 263          ** Returned value   :NONE
 264          **
 265          **----------------------------------------------------------------------------
 266          ** V01.01  MJ  2016-04-23
 267          ******************************************************************************/
 268          void api_updated_LCDDisplayItem_per_second(void)
 269          {
 270   1          switch (gs_dis_ctl_var.mode )
 271   1          {
 272   2              case DIS_MODE_RESET:                     
 273   2                  gs_dis_ctl_var.keep_sec[3]--;
 274   2                  if(gs_dis_ctl_var.keep_sec[3]==0)  
 275   2                  {
 276   3                      gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
 277   3                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
 278   3                      gs_dis_ctl_var.ptr[0] = 0;
 279   3                      gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ
             -¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //                
 280   3                                      dis_num_char = 0;//ÏÔÊ¾µ±Ç°µçÁ¿
 281   3                              }
 282   2              break;
 283   2      
 284   2              case DIS_MODE_NOMAL:
 285   2                              if(button_flag  == 1)
 286   2                              {
 287   3                                      //button_flag &= (~BIT1);
 288   3                                      button_flag = 0;
 289   3                                      if(dis_num_char < 3)
 290   3                                      {
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 6   

 291   4                                              dis_num_char = 2;
 292   4                                      }
 293   3                                      if(dis_num_char == 5)
 294   3                                      {
 295   4                                              dis_num_char = 3;
 296   4                                      }
 297   3                                      else
 298   3                                      {
 299   4                                              dis_num_char ++;
 300   4                                      }
 301   3      
 302   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 303   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 304   3                              }
 305   2                              else if(MAGN_flag == 1)
 306   2                              {
 307   3                                      MAGN_flag = 0;
 308   3                                      if(dis_num_char < 3)
 309   3                                      {
 310   4                                              dis_num_char = 2;
 311   4                                      }
 312   3                                      if(dis_num_char == 5)
 313   3                                      {
 314   4                                              dis_num_char = 3;
 315   4                                      }
 316   3                                      else
 317   3                                      {
 318   4                                              dis_num_char ++;
 319   4                                      }
 320   3      
 321   3                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 322   3                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 323   3                              }
 324   2                              else
 325   2                              {
 326   3                                      if( gs_dis_ctl_var.keep_sec[0] > gs_dis_param.auto_sec)
 327   3                                      {
 328   4                                              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 329   4                                      }
 330   3                                      else
 331   3                                      {
 332   4                                              gs_dis_ctl_var.keep_sec[0]--;
 333   4                                              if( gs_dis_ctl_var.keep_sec[0] == 0)
 334   4                                              {
 335   5                                                      gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec; //ÂÖÏÔ³ÖÐøÊ±¼ä//
 336   5                                                      gs_dis_ctl_var.item = api_get_next_dis_item();
 337   5      
 338   5                                                      if(dis_num_char >= 2)
 339   5                                                      {
 340   6                                                              dis_num_char = 0;
 341   6                                                      }
 342   5                                                      else
 343   5                                                      {
 344   6                                                              dis_num_char++;//ÂÖÏÔ
 345   6                                                      }
 346   5                                              }
 347   4                                      }
 348   3                              }
 349   2              break;
 350   2      
 351   2              default:
 352   2                  gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 7   

 353   2              break;
 354   2      
 355   2          }   
 356   1      }
 357                     
 358          /*****************************************************************************
 359          ** Function name    :api_get_next_dis_item
 360          **
 361          ** Description         :·µ»ØÏÂÒ»¸öÏÔÊ¾ÏîÄ¿     
 362          **
 363          ** Parameters         :NONE          
 364          **
 365          ** Returned value   :NONE
 366          **
 367          **----------------------------------------------------------------------------
 368          ** V01.01  MJ  2016-04-23
 369          ******************************************************************************/
 370          INT8U api_get_next_dis_item(void)
 371          {
 372   1       //INT8U vaild_len;
 373   1       INT8U item;
 374   1      
 375   1          item = DIS_DEFAULT_ITEM;
 376   1          if((gs_dis_ctl_var.mode  ==DIS_MODE_NOMAL))
 377   1          {
 378   2              gs_dis_ctl_var.ptr[0]++;
 379   2              if((gs_dis_ctl_var.ptr[0]>=(gs_dis_param.auto_item[0]))||(gs_dis_ctl_var.ptr[0]>DIS_MAX_ITEM))  //
             -ÏîÄ¿Îª0~6,¹²7Ïî //
 380   2              {
 381   3                  gs_dis_ctl_var.ptr[0]=0;
 382   3              }
 383   2      
 384   2              item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ 
             -//
 385   2              if(item>DIS_MAX_ITEM)   
 386   2              {
 387   3                  item =     DIS_DEFAULT_ITEM;
 388   3              }
 389   2          }
 390   1          return (item);
 391   1      }
 392          
 393          //*****************************************************************
 394          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 395          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 396          //  Input:                                                                            
 397          //  Output:         no                              
 398          //  Return:         no                              
 399          //  Others:         
 400          //***************************************************************/
 401          INT8U Link_Get_DisTab_Var(INT8U u8_dis_itm)
 402          {
 403   1       INT8U i;
 404   1       INT8U u8_result=FALSE;
 405   1      
 406   1              if(u8_dis_itm>DIS_MAX_ITEM)
 407   1              {
 408   2                      u8_dis_itm = DIS_DEFAULT_ITEM;    // ÏµÍ³ÏÔÊ¾ÏîÄ¿Òì³£ºóµÄÄ¬ÈÏÎªÏÔÊ¾ÏµÍ³´íÎóÆÁ  //
 409   2              }
 410   1      
 411   1      
 412   1              for( i = 0 ; i <=DIS_MAX_ITEM ; i++ )
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 8   

 413   1              {
 414   2                      if( u8_dis_itm== LcdDisTab[i].DisID)
 415   2                      {
 416   3                              gs_LCDDISTAB_var.DisID = u8_dis_itm;
 417   3                              gs_LCDDISTAB_var.ObisNum= LcdDisTab[i].ObisNum;
 418   3                              gs_LCDDISTAB_var.Addr =LcdDisTab[i].Addr;
 419   3                              gs_LCDDISTAB_var.DisInfo = LcdDisTab[i].DisInfo;
 420   3                              gs_LCDDISTAB_var.chartype = LcdDisTab[i].chartype;
 421   3                              gs_LCDDISTAB_var.obis_digit= LcdDisTab[i].obis_digit;
 422   3                              u8_result = TRUE;
 423   3                              return (u8_result);
 424   3                      }
 425   2              }
 426   1      
 427   1              if(u8_result == FALSE )
 428   1              {
 429   2                      gs_LCDDISTAB_var.DisID = DIS_DEFAULT_ITEM;  // Ä¬ÈÏÏÔÊ¾µ±Ç°ÓÐ¹¦×Ü 
 430   2                      gs_LCDDISTAB_var.ObisNum = LcdDisTab[0x01].ObisNum;
 431   2                      gs_LCDDISTAB_var.Addr =LcdDisTab[0x01].Addr;
 432   2                      gs_LCDDISTAB_var.DisInfo = LcdDisTab[0x01].DisInfo;
 433   2                      gs_LCDDISTAB_var.chartype = LcdDisTab[0x01].chartype;           
 434   2              }
 435   1              return (u8_result);
 436   1                              
 437   1      }
 438          
 439          
 440          //*****************************************************************
 441          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 442          //  Description:    »ñÈ¡OBISÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 2¸ö8×ÖÇø                                       
 443          //  Input:                                                                            
 444          //  Output:         no                              
 445          //  Return:         no                              
 446          //  Others:         dis_obis_buff[0] ¶ÔÓ¦OBISÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 447          //***************************************************************/
 448          void Link_Get_Dis_OBIS_Num_buff(void)
 449          { 
 450   1              INT8U   u8_len,u8_mem_type,lib_len;
 451   1              ST_U32_U08      u32_tmp,buffer;
 452   1              
 453   1              u8_len = (INT8U)gs_LCDDISTAB_var.DisInfo;
 454   1              
 455   1              if(u8_len>2) u8_len= 2;
 456   1              u8_mem_type =  (INT8U)(gs_LCDDISTAB_var.DisInfo>>8);
 457   1              //¼ì²âµ½À­Õ¢ºó £¬OBISÇø¹Ì¶¨ÏÔÊ¾oFF yang 2017-12-27// 
 458   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 459   1              {
 460   2                      gs_dis_pixel_var.dis_obis_buff[0] = 0x36 ;      //o
 461   2                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[0x0F]; //F
 462   2                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[0x0F];//F
 463   2                      return;
 464   2              }
 465   1              // Êý¾Ý»ñÈ¡´¦Àí  //
 466   1              switch (gs_LCDDISTAB_var.chartype)
 467   1              {
 468   2                      case CHAR_V://Êý¾ÝÇ°ÒÆ1Î»
 469   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 470   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 471   2                              break;
 472   2                              
 473   2                      case CHAR_HZ:
 474   2                                      mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 9   

 475   2                                      Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 476   2                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 477   2                              break;
 478   2                              
 479   2                      case CHAR_PF:
 480   2                                              mem_read(&u32_tmp.B08[2],gs_LCDDISTAB_var.Addr, 2, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 481   2                                              Lib_word_bcd2(&buffer.B08[0],u32_tmp.W16[1]);              //  16½øÖÆ×ª10½øÖÆ// 
 482   2                                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 483   2                              break;
 484   2      
 485   2                      case CHAR_A: //xxx.xxx A
 486   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 487   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
 488   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 489   2                                              if(lib_len<=4)
 490   2                                              {
 491   3                                                      buffer.u32 =((buffer.u32&0x0000FFFF)<<16);
 492   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 493   3                                              }
 494   2                                              else if(lib_len==5)
 495   2                                              {
 496   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 497   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 498   3                                              }
 499   2                                              else if(lib_len==6)
 500   2                                              {
 501   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 502   3                                              }
 503   2                                              else if(lib_len==7)
 504   2                                              {
 505   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 506   3                                              }
 507   2                                              else 
 508   2                                              {
 509   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 510   3                                              }
 511   2                              break;                  
 512   2                      case CHAR_KW:// xx.xxxx kW
 513   2                                              mem_read(&u32_tmp.B08[0],gs_LCDDISTAB_var.Addr, 4, u8_mem_type);                //»ñÈ¡µ±Ç°Êý¾Ý //
 514   2                                              Lib_long_bcd4(&buffer.B08[0],u32_tmp.u32);                      //      16½øÖÆ×ª10½øÖÆ// 
 515   2                                              lib_len=Lib_ENOB_Get(&buffer.B08[0],4,1);
 516   2                                              if(lib_len<=5)
 517   2                                              {
 518   3                                                      buffer.u32 =((buffer.u32&0x000FFFFF)<<12);
 519   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P8; 
 520   3                                              }
 521   2                                              else if(lib_len==6)
 522   2                                              {
 523   3                                                      buffer.u32 =((buffer.u32&0x00FFFFFF)<<8);
 524   3                                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P9; 
 525   3                                              }
 526   2                                              else if(lib_len==7)
 527   2                                              {
 528   3                                                      buffer.u32 =((buffer.u32&0x0FFFFFFF)<<4);
 529   3                                              }
 530   2                                              else 
 531   2                                              {
 532   3                                                      buffer.u32 =(buffer.u32&0xFFFFFFFF);
 533   3                                              }
 534   2                              break;                  
 535   2      
 536   2                                              
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 10  

 537   2                      default:
 538   2                              mem_read(&buffer.B08[0],gs_LCDDISTAB_var.Addr, u8_len, u8_mem_type);            //»ñÈ¡µ±Ç°Êý¾Ý //
 539   2                              break;
 540   2              }
 541   1              // ²âÊÔ/// 0XE6
 542   1              //      buffer.B08[3] = 0XE6;
 543   1              //      buffer.B08[2] = 0x07;
 544   1              //      buffer.B08[1] = 0x42;
 545   1              //      buffer.B08[0] = 0x48;
 546   1              //////////////
 547   1              
 548   1                      switch(u8_len)
 549   1                      {
 550   2                              case 2:
 551   2                                      gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 552   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[(buffer.B08[0]&0x0F)]; 
 553   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[(buffer.B08[1]&0xF0)>>4] ;  
 554   2                                      break;
 555   2                              case 1:
 556   2                                      gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[(buffer.B08[1]&0xF0)>>4] ;  
 557   2                                      gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[(buffer.B08[1]&0x0F)]; 
 558   2                                      break;
 559   2                              default:          // ³¤¶ÈÎª0 ÏÔÊ¾¿Õ
 560   2                                         break;
 561   2                      }
 562   1                      
 563   1      
 564   1      }               
 565                          
 566          
 567          
 568          //*****************************************************************
 569          //  Function:      void Link_Get_Dis_OBIS_Num_buff(void)      
 570          //  Description:    »ñÈ¡DATAÇøµÄÏÔÊ¾ÄÚÈÝ£¬ 8¸ö8×ÖÇø                                       
 571          //  Input:                                                                            
 572          //  Output:         no                              
 573          //  Return:         no                              
 574          //  Others:         dis_data_buff[0] ¶ÔÓ¦NUMÇøÏÔÊ¾µÄ×î×ó±ß1Î»(¸ßÎ»)
 575          //***************************************************************/
 576          void Link_Get_Dis_Data_Num_buff(void)
 577          {
 578   1              ST_U32_U08   buffer;
 579   1              INT8U  temp[6];
 580   1              NEW_MMD_DATA_UNIT t;
 581   1              RTC_TYPE rtc_data_tmp;
 582   1              ////ÉÏÅÅ¹Ì¶¨ÏÔÊ¾µ±Ç°×ÜµçÁ¿ yana 2017-12-15////  2018-11-20¸ÄÎªÉÏÅÅÏÔÊ¾¿É±äcxy
 583   1      
 584   1              if(dis_data_type == CHAR_TIME && dis_data_sec != 0)
 585   1              {       //ÏÔÊ¾Ê±¼ä
 586   2                      Get_RTCTime(&rtc_data_tmp);
 587   2      
 588   2                      gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[rtc_data_tmp.Hour>>4];
 589   2                      gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[rtc_data_tmp.Hour&0x0F];
 590   2                      gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[rtc_data_tmp.Minute>>4];
 591   2                      gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[rtc_data_tmp.Minute&0x0F];
 592   2                      gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[rtc_data_tmp.Second>>4];
 593   2                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[rtc_data_tmp.Second&0x0F];
 594   2                      dis_data_sec --;
 595   2                      if(dis_data_sec == 0){dis_data_type = 0;}
 596   2              }
 597   1              else
 598   1              {       
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 11  

 599   2                      if(dis_num_char == 0)
 600   2                      {
 601   3                              //ÏÔÊ¾µ±Ç°µçÁ¿ kwh
 602   3                              mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RAM)
             -;          //»ñÈ¡µ±Ç°Êý¾Ý //
 603   3                              //mem_read(&temp[0], ADR_BLOCK00_EC_L0_E2P, 6, MEM_E2P1);
 604   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 605   3                              //debug////
 606   3                              //buffer.B08[1]=0x12;
 607   3                              //buffer.B08[2]=0x34;
 608   3                              //buffer.B08[3]=0x56;
 609   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 610   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 611   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 612   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
 613   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 614   3                              if(gs_dis_param.ec_form!=0x50)
 615   3                              {
 616   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 617   4                              }
 618   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 619   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 620   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[0]; 
 621   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[1] ;
 622   3                      }
 623   2                      if(dis_num_char == 1)
 624   2                      {
 625   3                              //ÏÔÊ¾µ±Ç°ÐèÁ¿kw
 626   3                              //mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 627   3                              mem_read(&t, ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);                                   
*** WARNING C182 IN LINE 627 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 628   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 629   3      //                      mem_read(&buffer.B08[0], ADR_BLOCK_4MMD_L0_E2P, 4, MEM_E2P1);
 630   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 631   3                              //debug////
 632   3                              //buffer.B08[1]=0x12;
 633   3                              //buffer.B08[2]=0x34;
 634   3                              //buffer.B08[3]=0x56;
 635   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 636   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 637   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 638   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 639   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 640   3      //                      if(gs_dis_param.ec_form!=0x50)
 641   3      //                      {
 642   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 643   3      //                      }
 644   3      
 645   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 646   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 647   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[0]; 
 648   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[2] ;
 649   3                      }
 650   2                      if(dis_num_char == 2)
 651   2                      {
 652   3                              //ÏÔÊ¾µ±Ç°ÀÛ¼ÆÐèÁ¿kw
 653   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 654   3                              mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P, 4, MEM_E2P1);
*** WARNING C182 IN LINE 654 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 655   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 12  

 656   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 657   3                              //debug////
 658   3                              //buffer.B08[1]=0x12;
 659   3                              //buffer.B08[2]=0x34;
 660   3                              //buffer.B08[3]=0x56;
 661   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 662   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 663   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 664   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 665   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 666   3      //                      if(gs_dis_param.ec_form!=0x50)
 667   3      //                      {
 668   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 669   3      //                      }
 670   3      
 671   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 672   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 673   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[0]; 
 674   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[4] ;
 675   3                      }
 676   2                      if(dis_num_char == 3)
 677   2                      {
 678   3                              //ÏÔÊ¾Ç°Ò»ÌìµçÁ¿kwh
 679   3      //                      mem_read(&temp[0], ADR_BLOCK_4Energy_L0_E2P+LEN_BLOCK_4Energy_E2P/4, LEN_BLOCK_4Energy_E2P/4, MEM_E2P
             -1);          //»ñÈ¡µ±Ç°Êý¾Ý //
 680   3                              mem_read(&temp[0], &energy_data_array[1].buf[0], LEN_BLOCK_4Energy_E2P/4,MEM_RAM);
*** WARNING C214 IN LINE 680 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: 'Argument': conversion: pointer to non-pointer
 681   3                              api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 682   3                              //debug////
 683   3                              //buffer.B08[1]=0x12;
 684   3                              //buffer.B08[2]=0x34;
 685   3                              //buffer.B08[3]=0x56;
 686   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4] ;  
 687   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0x0F)];
 688   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4] ;  
 689   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0x0F)]; 
 690   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4] ;  
 691   3                              if(gs_dis_param.ec_form!=0x50)
 692   3                              {
 693   4                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0x0F)]; 
 694   4                              }
 695   3      
 696   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 697   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 698   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[2]; 
 699   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[1] ;
 700   3                      }
 701   2                      if(dis_num_char == 4)
 702   2                      {
 703   3                              //ÏÔÊ¾Ç°Ò»ÌìÐèÁ¿kw
 704   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 705   3                              mem_read(&t, ADR_BLOCK_4MMD_L0_E2P+LEN_NEW_MMD_UNIT, 4, MEM_E2P1);
*** WARNING C182 IN LINE 705 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 706   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 707   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 708   3                              //debug////
 709   3                              //buffer.B08[1]=0x12;
 710   3                              //buffer.B08[2]=0x34;
 711   3                              //buffer.B08[3]=0x56;
 712   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 713   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 13  

 714   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 715   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 716   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 717   3      //                      if(gs_dis_param.ec_form!=0x50)
 718   3      //                      {
 719   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 720   3      //                      }
 721   3      
 722   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 723   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 724   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[2]; 
 725   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[2] ;
 726   3                      }
 727   2                      if(dis_num_char == 5)
 728   2                      {
 729   3                              //ÏÔÊ¾Ç°Ò»ÌìÀÛ¼ÆÐèÁ¿kw
 730   3      //                      mem_read(&temp[0], (INT16U)&gs_energy_user_data.us_val[EC_CH_AC_PT_TT][0].buf[0], LEN_EC_UNIT, MEM_RA
             -M);          //»ñÈ¡µ±Ç°Êý¾Ý //
 731   3                              mem_read(&t, ADR_BLOCK_4MMD_sum_L0_E2P+LEN_SUM_MMD_UNIT, 4, MEM_E2P1);
*** WARNING C182 IN LINE 731 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: pointer to different objects
 732   3                              Lib_long_bcd4(&buffer.B08[0],t.val.val_hex32);
 733   3      //                      api_get_energy_LCD(&temp[0], gs_dis_param.ec_form,&buffer.B08[0]);
 734   3                              //debug////
 735   3                              //buffer.B08[1]=0x12;
 736   3                              //buffer.B08[2]=0x34;
 737   3                              //buffer.B08[3]=0x56;
 738   3                              gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(buffer.B08[0]&0x0F)] ;  
 739   3                              gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(buffer.B08[1]&0xF0)>>4];
 740   3                              gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(buffer.B08[1]&0x0F)] ;  
 741   3                              gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(buffer.B08[2]&0xF0)>>4]; 
 742   3                              gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(buffer.B08[2]&0x0F)] ;  
 743   3      //                      if(gs_dis_param.ec_form!=0x50)
 744   3      //                      {
 745   3                                      gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(buffer.B08[3]&0xF0)>>4]; 
 746   3      //                      }
 747   3      
 748   3                              //ÏÂÅÅÏÔÊ¾  2019-01-11
 749   3                              //gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(buffer.B08[0]&0xF0)>>4] ;  
 750   3                              gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[2]; 
 751   3                              gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[4] ;
 752   3                      }
 753   2              }
 754   1      }
 755          //*****************************************************************
 756          //  Function:       void Link_Get_Dis_Char_buff(void) 
 757          //  Description:    »ñÈ¡ÏÔÊ¾µÄÅäºÏ×Ö·ûÐÅÏ¢                                      
 758          //  Input:                                                                            
 759          //  Output:         no                              
 760          //  Return:         no                              
 761          //  Others:         
 762          //***************************************************************/
 763          void Link_Get_Dis_Char_buff(void)
 764          {
 765   1      //      RTC_TYPE rtc_data_tmp;
 766   1      //      Get_RTCTime(&rtc_data_tmp);//»ñÈ¡Ê±¼äÏÔÊ¾·ÑÂÊ
 767   1      //      if(rtc_data_tmp.Hour)
 768   1              //2019-01-25 cxy ÏÂµç²»ÏÔÊ¾·ÑÂÊºÅ
 769   1              if(gs_sys_globaL_var.work_mode != SLEEP_MODE)
 770   1              {
 771   2                      switch (gs_current_triff_var.triff_No)//ÏÔÊ¾·ÑÂÊ
 772   2                      {
 773   3                              case 1:
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 14  

 774   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S1;
 775   3                                      break;
 776   3                              case 2:
 777   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S2;
 778   3                                      break;
 779   3                              case 3:
 780   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S3;
 781   3                                      break;
 782   3                              case 4:
 783   3                                      gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_S4;
 784   3                                      break;
 785   3                      }
 786   2              }
 787   1              if(dis_data_type == CHAR_TIME)
 788   1              {
 789   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P1P2;
 790   2                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P4P5;
 791   2              }
 792   1              else
 793   1              {       
 794   2                      if(dis_num_char == 0 || dis_num_char == 3)
 795   2                      {
 796   3                              if(gs_dis_param.ec_form!=0x50)
 797   3                              {
 798   4                                      gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 799   4                              }
 800   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kWh;  //kWh
 801   3                      }
 802   2                      else
 803   2                      {
 804   3      //                      if(gs_dis_param.ec_form!=0x50)
 805   3      //                      {
 806   3      //                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P6;  //
 807   3      //                      }
 808   3                              gs_dis_pixel_var.dis_char_buff[0] |= CHAR_DATA_P3;
 809   3                              gs_dis_pixel_var.dis_char_buff[1] |= CHAR_DATA_kW;  //kW
 810   3                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_MD;
 811   3                      }
 812   2              }
 813   1              if(gs_relay_manage_var.u8_STA== CMD_RELAY_ON)
 814   1              {
 815   2                      return;
 816   2              }
 817   1              if(gs_dis_ctl_var.item== DIS_DATA_CLR)
 818   1              {
 819   2                      return;
 820   2              }
 821   1      
 822   1              // DATA ÇøµÄÐ¡ÊýµãºÍµ¥Î»×Ö·û»ñÈ¡ //
 823   1      //      switch(gs_LCDDISTAB_var.chartype)
 824   1              switch(gs_LCDDISTAB_var.chartype = 10)
*** WARNING C276 IN LINE 824 OF ..\C_SOURCE\S4_APIUSER\API_LCD_DISPLAY.C: constant in condition expression
 825   1              {
 826   2                      case CHAR_V:    // µçÑ¹ÏÔÊ¾ xxx V //
 827   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_V; 
 828   2                              break;
 829   2                      case CHAR_A:    // µçÁ÷ÏÔÊ¾ xx.x A//
 830   2                              gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_A; 
 831   2                              break;
 832   2                      case CHAR_KW:    // ¹¦ÂÊÏÔÊ¾ xx.x kw//
 833   2                          gs_dis_pixel_var.dis_char_buff[2] |= (CHAR_DATA_k+CHAR_DATA_W);  //kW
 834   2                              break;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 15  

 835   2                      case CHAR_HZ:   // ÆµÂÊÏÔÊ¾ xx.x HZ//
 836   2                          gs_dis_pixel_var.dis_char_buff[2] |= CHAR_DATA_Hz;  //Hz
 837   2                              break;
 838   2                      default:
 839   2                              break;
 840   2              }       
 841   1      
 842   1                              
 843   1      }
 844          
 845          //*****************************************************************
 846          //  Function:       INT8U Link_Get_DisIndex(u8_dis_itm)        
 847          //  Description:    »ñÈ¡ÏÔÊ¾ÏîÄ¿ÐÅÏ¢                                        
 848          //  Input:                                                                            
 849          //  Output:         no                              
 850          //  Return:         no                              
 851          //  Others:         
 852          //***************************************************************/
 853          void Link_Get_Dis_RealChar_buff(void)
 854          {
 855   1      
 856   1               if(gs_measure_status_judge_var.u8_status & VBAT_LOW)           gs_dis_pixel_var.dis_char_buff[2] |=CHAR_
             -DATA_S9;        //µç³ØÇ·Ñ¹
 857   1               if(gs_emu_run_var.net_flg&REV_TT_ACPOWER)
 858   1              {
 859   2                      gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Received;//·´ÏòÌáÊ¾
 860   2              }
 861   1               else
 862   1              {
 863   2                       gs_dis_pixel_var.dis_char_buff[1] |=CHAR_DATA_Delivered;// Ä¬ÈÏÕýÏòÏÔÊ¾
 864   2              }
 865   1      }
 866          
 867          
 868          //*****************************************************************
 869          //  Function:      void Link_Get_Dis_Drv_buff(void)   
 870          //  Description:    »ñÈ¡ÏÔÊ¾»º³åbuffµÄÊý¾Ý                                    
 871          //  Input:                                                                            
 872          //  Output:         no                              
 873          //  Return:         no                              
 874          //  Others:         
 875          //***************************************************************/
 876          void Link_Get_Dis_Drv_buff(void)
 877          {
 878   1              gs_dis_pixel_var.dis_buff[0] |= (gs_dis_pixel_var.dis_data_buff[0] &0x7F);
 879   1              gs_dis_pixel_var.dis_buff[1] |= (gs_dis_pixel_var.dis_data_buff[1] &0x7F);
 880   1              gs_dis_pixel_var.dis_buff[2] |= (gs_dis_pixel_var.dis_data_buff[2] &0x7F);
 881   1              gs_dis_pixel_var.dis_buff[3] |= (gs_dis_pixel_var.dis_data_buff[3] &0x7F);
 882   1              gs_dis_pixel_var.dis_buff[4] |= (gs_dis_pixel_var.dis_data_buff[4] &0x7F);
 883   1              gs_dis_pixel_var.dis_buff[5] |= (gs_dis_pixel_var.dis_data_buff[5] &0x7F);
 884   1      
 885   1              gs_dis_pixel_var.dis_buff[6] |= (gs_dis_pixel_var.dis_obis_buff[0] &0xEF);
 886   1              gs_dis_pixel_var.dis_buff[7] |= (gs_dis_pixel_var.dis_obis_buff[1] &0xEF);
 887   1              gs_dis_pixel_var.dis_buff[8] |= (gs_dis_pixel_var.dis_obis_buff[2] &0xEF);
 888   1      
 889   1              
 890   1               //  dis_var.dis_char_buff[0:2] µÄ×ª»»//
 891   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P1P2)   {gs_dis_pixel_var.dis_buff[1] |= BIT7;gs_dis_pixel_
             -var.dis_buff[2] |= BIT7;}
 892   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P3)     gs_dis_pixel_var.dis_buff[3] |= BIT7;
 893   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P4P5)   {gs_dis_pixel_var.dis_buff[4] |= BIT7;gs_dis_pixe
             -l_var.dis_buff[9] |= BIT7;}
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 16  

 894   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P6)     gs_dis_pixel_var.dis_buff[5] |= BIT7;
 895   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P7)     gs_dis_pixel_var.dis_buff[6] |= BIT4;
 896   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P8)     gs_dis_pixel_var.dis_buff[7] |= BIT4;
 897   1              if(gs_dis_pixel_var.dis_char_buff[0] &CHAR_DATA_P9)     gs_dis_pixel_var.dis_buff[8] |= BIT4;
 898   1              
 899   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kWh)    {gs_dis_pixel_var.dis_buff[9] |= BIT6;gs_dis_pixe
             -l_var.dis_buff[9] |= BIT2;}
 900   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_kW)     gs_dis_pixel_var.dis_buff[9] |= BIT6;
 901   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S1)     gs_dis_pixel_var.dis_buff[9] |= BIT4;
 902   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S2)     gs_dis_pixel_var.dis_buff[9] |= BIT0;
 903   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S3)     gs_dis_pixel_var.dis_buff[9] |= BIT5;
 904   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_S4)     gs_dis_pixel_var.dis_buff[9] |= BIT1;
 905   1      
 906   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Received)       gs_dis_pixel_var.dis_buff[10] |= BIT7;
 907   1              if(gs_dis_pixel_var.dis_char_buff[1] &CHAR_DATA_Delivered)      gs_dis_pixel_var.dis_buff[10] |= BIT6;
 908   1      
 909   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_k)              gs_dis_pixel_var.dis_buff[10] |= BIT0;
 910   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_W)              
 911   1              {
 912   2                      gs_dis_pixel_var.dis_buff[10] |= BIT1;
 913   2                      gs_dis_pixel_var.dis_buff[10] |= BIT2;
 914   2                      gs_dis_pixel_var.dis_buff[11] |= BIT6;
 915   2                      gs_dis_pixel_var.dis_buff[11] |= BIT7;
 916   2              }
 917   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_V)              {gs_dis_pixel_var.dis_buff[10] |= BIT1;gs_dis_pixel_v
             -ar.dis_buff[10] |= BIT2;}
 918   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_A)              
 919   1              {
 920   2                      gs_dis_pixel_var.dis_buff[11] |= BIT7;
 921   2                      gs_dis_pixel_var.dis_buff[10] |= BIT2;
 922   2                      gs_dis_pixel_var.dis_buff[10] |= BIT3;
 923   2              }
 924   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_Hz)             gs_dis_pixel_var.dis_buff[11] |= BIT5;
 925   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_PF)             gs_dis_pixel_var.dis_buff[11] |= BIT4;
 926   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_MD)             gs_dis_pixel_var.dis_buff[10] |= BIT4;
 927   1              if(gs_dis_pixel_var.dis_char_buff[2] &CHAR_DATA_S9)             gs_dis_pixel_var.dis_buff[10] |= BIT5;
 928   1              
 929   1      }
 930          
 931          
 932          /*****************************************************************************
 933          ** Function name    :api_clr_current_energy_data
 934          **
 935          ** Description         : ÐèÁ¿µçÁ¿Êý¾Ý×ª»»
 936          **
 937          ** Parameters         :  type Êý¾ÝÀàÐÍ     0Ä¬ÈÏÈ«ÕûÊý 
 938          **
 939          ** Returned value   :NONE
 940          **
 941          **----------------------------------------------------------------------------
 942          ** V01.01  MJ  2016-04-23
 943          ******************************************************************************/
 944          void api_get_energy_LCD(uint8*  temp, uint8 type, uint8*  result)
 945          {
 946   1       ST_U32_U08   u32_result, BCD_temp;
 947   1       US_EC_DATA_UNIT ec_tmp;
 948   1         
 949   1          // if(type!=0x50)     type= 0x51;
 950   1          //µçÁ¿¸ñÊ½Êý¾Ý¸³Öµ //
 951   1          Lib_Copy_Str_TwoArry(&ec_tmp.buf[0], temp, LEN_EC_UNIT);
 952   1              
 953   1          u32_result.u32 =0;
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 17  

 954   1      
 955   1              if(type==0x80)
 956   1          {
 957   2              if(ec_tmp.val.integ_hex32>=100000000)   ec_tmp.val.integ_hex32 -=100000000;
 958   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
 959   2          }
 960   1          
 961   1          if(type==0x62)
 962   1          {
 963   2              // ÕûÊý²¿·Ö´¦Àí //
 964   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 965   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
 966   2              u32_result.B08[0]= BCD_temp.B08[1];
 967   2              u32_result.B08[1]= BCD_temp.B08[2];
 968   2              u32_result.B08[2]= BCD_temp.B08[3];
 969   2      
 970   2               // Ð¡Êý²¿·Ö´¦Àí //
 971   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
 972   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
 973   2      
 974   2          }
 975   1          if(type==0x60)
 976   1          {
 977   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 978   2              Lib_long_bcd4(&u32_result.B08[0],ec_tmp.val.integ_hex32);       
 979   2          }
 980   1          
 981   1          if(type==0x61)
 982   1          {
 983   2              // ÕûÊý²¿·Ö´¦Àí //
 984   2              if(ec_tmp.val.integ_hex32>=1000000)   ec_tmp.val.integ_hex32 -=1000000;
 985   2              Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
 986   2              u32_result.B08[0]= BCD_temp.B08[1];
 987   2              u32_result.B08[1]= BCD_temp.B08[2];
 988   2              u32_result.B08[2]= BCD_temp.B08[3];
 989   2      
 990   2               // Ð¡Êý²¿·Ö´¦Àí //
 991   2               ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
 992   2               u32_result.B08[3] = Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16);
 993   2      
 994   2          }
 995   1          if(type==0x51)
 996   1          {
 997   2                      // ÕûÊý²¿·Ö´¦Àí //
 998   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
 999   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1000   2                      u32_result.B08[0]= 0x00;
1001   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
1002   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1003   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1004   2      
1005   2                      // Ð¡Êý²¿·Ö´¦Àí //
1006   2                      ec_tmp.val.decim_hex16  /= METER_CONST_10WH;
1007   2                      u32_result.B08[3]|=(((Lib_byte_bcd((INT8U)ec_tmp.val.decim_hex16))&0xF0)>>4);
1008   2          }
1009   1          if(type==0x50)
1010   1          {
1011   2                      // ÕûÊý²¿·Ö´¦Àí //
1012   2                      if(ec_tmp.val.integ_hex32>=100000)   ec_tmp.val.integ_hex32 -=100000;
1013   2                      Lib_long_bcd4(&BCD_temp.B08[0],ec_tmp.val.integ_hex32);
1014   2                      u32_result.B08[0]= 0x00;
1015   2                      u32_result.B08[1]= (((BCD_temp.B08[1]&0x0F)<<4)+((BCD_temp.B08[2]&0xF0)>>4));
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 18  

1016   2                      u32_result.B08[2]= (((BCD_temp.B08[2]&0x0F)<<4)+((BCD_temp.B08[3]&0xF0)>>4));
1017   2                      u32_result.B08[3]|= ((BCD_temp.B08[3]&0x0F)<<4);
1018   2          }
1019   1          //Êý¾ÝÊä³ö //
1020   1          Lib_Copy_Str_TwoArry(result, &u32_result.B08[0], 4);
1021   1      
1022   1      }
1023          
1024          
1025          /*****************************************************************************
1026          ** Function name    :api_init_md_data_ram
1027          **
1028          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1029          **
1030          ** Parameters         :NONE          
1031          **
1032          ** Returned value   :NONE
1033          **
1034          **----------------------------------------------------------------------------
1035          ** V01.01  MJ  2016-04-23
1036          ******************************************************************************/
1037          void api_chg_LCDDisplay_adj_item(uint8 u8_item)
1038          {
1039   1          if((u8_item>=DIS_ADJ_CH1_0) &&(u8_item<=DIS_DATA_BROADCAST))
1040   1          {
1041   2              //¸ü¸ÄÐ£×¼ÏÔÊ¾ÏîÄ¿//
1042   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1043   2                      if(u8_item==DIS_DATA_BROADCAST)
1044   2                      {
1045   3                      gs_dis_ctl_var.keep_sec[0] = 10;    //Ç¿ÖÆÏÔÊ¾10Ãë //
1046   3                      }
1047   2                      else
1048   2                      {
1049   3                      gs_dis_ctl_var.keep_sec[0] = 5;    //Ç¿ÖÆÏÔÊ¾5Ãë //
1050   3                      }
1051   2                      //gs_dis_ctl_var.keep_sec[0] = 2;
1052   2              gs_dis_ctl_var.ptr[0] = 0;
1053   2              gs_dis_ctl_var.item = u8_item;    
1054   2          }
1055   1          else
1056   1          {
1057   2              //Òì³£Çé¿öÏÂÏÔÊ¾×Ô¶¯Ñ­ÏÔÏîÄ¿ //
1058   2              gs_dis_ctl_var.mode = DIS_MODE_NOMAL;
1059   2              gs_dis_ctl_var.keep_sec[0] = gs_dis_param.auto_sec;
1060   2              gs_dis_ctl_var.ptr[0] = 0;
1061   2              gs_dis_ctl_var.item = gs_dis_param.auto_item[gs_dis_ctl_var.ptr[0]+1];  //  0Î»ÖÃÎªÏÔÊ¾ÏîÄ¿¸öÊý£¬1
             -Î»ÖÃ¿ªÊ¼ÎªÏîÄ¿ //  
1062   2          }
1063   1      
1064   1          api_updated_LCDDisplayPixel_per_second();
1065   1      }
1066          
1067          /*****************************************************************************
1068          ** Function name    :api_init_md_data_ram
1069          **
1070          ** Description         :Ã¿Ãë¸üÐÂÒº¾§ÏÔÊ¾ÏîÄ¿       
1071          **
1072          ** Parameters         :NONE          
1073          **
1074          ** Returned value   :NONE
1075          **
1076          **----------------------------------------------------------------------------
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 19  

1077          ** V01.01  MJ  2016-04-23
1078          ******************************************************************************/
1079          void api_LCDDisplay_adj_item(uint8 u8_item)
1080          {
1081   1              INT8U adr[6];
1082   1          if((u8_item<DIS_ADJ_CH1_0) &&(u8_item>DIS_DATA_BROADCAST))
1083   1          {
1084   2              return;
1085   2          }
1086   1      
1087   1          Lib_Set_String(&gs_dis_pixel_var.dis_data_buff[0],0,DS_DATANum);    
1088   1          Lib_Set_String(&gs_dis_pixel_var.dis_obis_buff[0],0,DS_OBISNum);
1089   1          Lib_Set_String(&gs_dis_pixel_var.dis_char_buff[0] ,0,DS_CHARNum);
1090   1      
1091   1          // Êý¾Ý»ñÈ¡´¦Àí  //A F E D B G C MD  //
1092   1          switch (u8_item)
1093   1          {
1094   2              case DIS_ADJ_CH1_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1095   2              case DIS_ADJ_CH1_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1096   2              case DIS_ADJ_CH1_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1097   2              case DIS_ADJ_CH1_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1098   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1099   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;               //LCD-D2  H  //
1100   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X01]       ;     //LCD-D3  1  //
1101   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                 //LCD-D4  -//
1102   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)]     ;  //LCD-D5  0~3  //
1103   2              break;
1104   2      
1105   2              case DIS_ADJ_CH2_0:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1106   2              case DIS_ADJ_CH2_1:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1107   2              case DIS_ADJ_CH2_2:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1108   2              case DIS_ADJ_CH2_3:     //L »ØÂ·Ð£±í²ÎÊý³õÊ¼»¯ //
1109   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[0X0C]       ;      //LCD-D1  C  //
1110   2                  gs_dis_pixel_var.dis_data_buff[1] = 0x76    ;                                //LCD-D2  H  //
1111   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[0X02]       ;     //LCD-D3  2  //
1112   2                  gs_dis_pixel_var.dis_data_buff[3] = 0X20    ;                                 //LCD-D4  -//
1113   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(u8_item&0X0F)-4]   ;     //LCD-D5  0~3  //
1114   2              break;
1115   2      
1116   2              case DIS_DATA_CLR:      //ÇåÁãÏÔÊ¾ //
1117   2                  gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[0X0C]       ;      //LCD-D1  C  //
1118   2                  gs_dis_pixel_var.dis_obis_buff[1] = 0xA1    ;              //LCD-D2  L  //
1119   2                  gs_dis_pixel_var.dis_obis_buff[2] = 0x60    ;              //LCD-D3  r  //
1120   2              break;
1121   2                      
1122   2              case DIS_DATA_BROADCAST:        //¹ã²¥ÃüÁîÏÔÊ¾Í¨Ñ¶µØÖ· //
1123   2                              mem_read(&adr[0], ADR_METER_PARAM1_RF_COMM_ID, 6, MEM_E2P1);//¶ÁÈ¡RFÍ¨Ñ¶µØÖ·
1124   2                  gs_dis_pixel_var.dis_data_buff[0] = NumSegD1_D6[(adr[1]&0x0F)];  
1125   2                  gs_dis_pixel_var.dis_data_buff[1] = NumSegD1_D6[(adr[2]&0xF0)>>4];
1126   2                  gs_dis_pixel_var.dis_data_buff[2] = NumSegD1_D6[(adr[2]&0x0F)];
1127   2                  gs_dis_pixel_var.dis_data_buff[3] = NumSegD1_D6[(adr[3]&0xF0)>>4];
1128   2                  gs_dis_pixel_var.dis_data_buff[4] = NumSegD1_D6[(adr[3]&0x0F)];
1129   2                  gs_dis_pixel_var.dis_data_buff[5] = NumSegD1_D6[(adr[4]&0xF0)>>4];
1130   2                  gs_dis_pixel_var.dis_obis_buff[0] = NumSegD7_D9[(adr[4]&0x0F)];
1131   2                  gs_dis_pixel_var.dis_obis_buff[1] = NumSegD7_D9[(adr[5]&0xF0)>>4];
1132   2                  gs_dis_pixel_var.dis_obis_buff[2] = NumSegD7_D9[(adr[5]&0x0F)];
1133   2              break;
1134   2              default:        
1135   2                  sys_err();
1136   2              break;
1137   2          }
1138   1       
C51 COMPILER V9.01   API_LCD_DISPLAY                                                       03/05/2019 13:48:06 PAGE 20  

1139   1      }
1140          
1141          
1142          /***************************************************************
1143          *    END
1144          ****************************************************************/
1145          
1146          
1147          
1148          
1149          
1150          
1151          
1152          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4983    ----
   CONSTANT SIZE    =    102    ----
   XDATA SIZE       =     62      65
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  6 WARNING(S),  0 ERROR(S)
